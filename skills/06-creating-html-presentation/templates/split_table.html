<section {% if slide.image %} data-background="{{ slide.image }}" data-background-opacity="0.5" {% endif %}
    data-background-gradient="{{ slide.background_gradient | default('radial-gradient(circle, #004d00 0%, #000000 100%)' if not slide.image else '') }}">

    <div class="slide-canvas"
        style="display: grid; grid-template-columns: 1fr; gap: 20px; align-items: center; height: 100%; max-width: 1200px; margin: auto; text-align: left;">

        <!-- Fixed min-height ensures consistent vertical centering across paginated slides -->
        <div
            style="padding: 20px; min-height: 60vh; display: flex; flex-direction: column; justify-content: flex-start;">
            {% if slide.badge %}
            <div>
                <h3
                    style="color: #FFD700; margin-bottom: 10px; font-size: 1.2em; border-bottom: 2px solid #FFD700; display: inline-block;">
                    {{ slide.badge }}</h3>
            </div>
            {% endif %}

            {% if slide.title %}
            <h1 style="font-size: 1.2em; margin-bottom: 20px; line-height: 1.1; text-shadow: 2px 2px 4px black;">{{
                slide.title }}</h1>
            {% endif %}

            {% if slide.rationale %}
            <div style="font-size: 0.9em; margin-bottom: 20px; color: #eee; font-style: italic; font-weight: 300;">
                <i class="fas fa-lightbulb" style="color: #FFD700; margin-right: 10px;"></i> {{ slide.rationale }}
            </div>
            {% endif %}

            <div style="font-size: 0.9em; line-height: 1.4; flex-grow: 1;">
                {{ slide.content | safe }}
            </div>

            {% if slide.timer %}
            <div class="timer-container" style="margin-top: 20px; justify-content: center; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                <div class="timer-display" id="timer-{{ slide.timer }}-display"
                    style="font-size: 2.2em; font-family: monospace; color: #FFD700; text-shadow: 0 0 10px rgba(0,0,0,0.8); margin-right: 20px;">
                    {% set mins = (slide.timer / 60) | int %}{% set secs = (slide.timer % 60) | int %}
                    {{ "%02d"|format(mins) }}:{{ "%02d"|format(secs) }}
                </div>
                <button class="timer-btn"
                    onclick="toggleTimer({{ slide.timer }}, 'timer-{{ slide.timer }}-display', this)">START</button>
                <button class="timer-btn reset"
                    onclick="resetTimer({{ slide.timer }}, 'timer-{{ slide.timer }}-display')">RESET</button>
            </div>
            {% endif %}
        </div>
    </div>

    <aside class="notes">
        {{ slide.notes | default('Monitor student progress.') }}
    </aside>
</section>
